{"name":"Docker-wine","tagline":"Wine on Docker with Dynamic Graphics drivers and VirtualGL support for with both local and remote access.","body":"# docker-wine\r\n[Wine](https://www.winehq.org/) on Docker with [Dynamic Graphic](https://github.com/yantis/docker-dynamic-video)\r\ndrivers and [VirtualGL](https://github.com/yantis/docker-virtualgl) with both local and remote support.\r\n\r\nIt should work out of the box with all Nvidia cards and Nvidia drivers and most other cards as well that use Mesa drivers.\r\nIt is setup to auto adapt to whatever drivers you may have installed as long as they are the most recent ones for your branch.\r\n\r\nOn Docker hub [wine](https://registry.hub.docker.com/u/yantis/wine/)\r\non Github [docker-wine](https://github.com/yantis/docker-wine/)\r\n\r\n\r\n## Description\r\nThe goal of this was to be able to run Windows apps on my Linux box from anywhere in the world but seamless as if it was a local application.\r\n(That means no VNC or window managers etc). As an example maybe I want to run windows Skype on a remote server like an \r\nAmazon EC2 so my IP address doesn't get leaked to to anyone using a Skype IP resolver. There are also a few programs that\r\nI like that just run on Windows.\r\n\r\nIn local mode it should just work out of the box. Though you do need to setup a shared folder as a volume to store your windows data.\r\nAll you should have to do is run [this](https://github.com/yantis/docker-wine/blob/master/runme-explorer.sh) script and it will launch\r\nthe windows explorer.\r\n\r\nI have included a [demo script](https://github.com/yantis/docker-wine/blob/master/examples/aws-sqlyog.sh) \r\nthat will start up an Amazon EC2 micro Instance, install docker, run the container and then connect to your docker container\r\nand run SQLyog and outputting it on your local display.\r\n\r\n[Here](https://github.com/yantis/docker-wine/blob/master/examples/remote-skype.sh) is another demo script \r\nthat launches a Skype on another machine (ie: on your local network. To use that video card instead of your own)\r\n\r\n\r\n### Docker Images Structure\r\n>[yantis/archlinux-tiny](https://github.com/yantis/docker-archlinux-tiny)\r\n>>[yantis/archlinux-small](https://github.com/yantis/docker-archlinux-small)\r\n>>>[yantis/archlinux-small-ssh-hpn](https://github.com/yantis/docker-archlinux-ssh-hpn)\r\n>>>>[yantis/ssh-hpn-x](https://github.com/yantis/docker-ssh-hpn-x)\r\n>>>>>[yantis/dynamic-video](https://github.com/yantis/docker-dynamic-video)\r\n>>>>>>[yantis/virtualgl](https://github.com/yantis/docker-virtualgl)\r\n>>>>>>>[yantis/wine](https://github.com/yantis/docker-wine)\r\n\r\n\r\n## Usage (Local)\r\n\r\nThis example launches the container and initializes the graphcs with your drivers and in this case\r\nruns Skype for Windows (Actually, it runs a script that sets it up if it isn't installed or runs it if it is)\r\n\r\n```bash\r\nxhost +si:localuser:$(whoami) >/dev/null\r\ndocker run \\\r\n    --privileged \\\r\n    --rm \\\r\n    -ti \\\r\n    -e DISPLAY \\\r\n    -v /tmp/.X11-unix:/tmp/.X11-unix:ro \\\r\n    -v ~/docker-data/wine:/home/docker/wine/ \\\r\n    -v /etc/localtime:/etc/localtime:ro \\\r\n    -u docker \\\r\n    yantis/wine /bin/bash -c \"sudo initialize-graphics >/dev/null 2>/dev/null; vglrun /home/docker/templates/skype.template;\"\r\n```\r\n\r\n### Breakdown\r\n\r\n```bash\r\n$ xhost +si:localuser:yourusername\r\n```\r\n\r\nAllows your local user to access the xsocket. Change yourusername or use $(whoami) or $USER if your shell supports it.\r\n\r\n```bash\r\ndocker run \\\r\n    --privileged \\\r\n    --rm \\\r\n    -ti \\\r\n    -e DISPLAY \\\r\n    -v /tmp/.X11-unix:/tmp/.X11-unix:ro \\\r\n    -v ~/docker-data/wine:/home/docker/wine/ \\\r\n    -v /etc/localtime:/etc/localtime:ro \\\r\n    -u docker \\\r\n    yantis/wine /bin/bash -c \"sudo initialize-graphics ; vglrun /home/docker/templates/skype.template;\"\r\n```\r\n\r\nThis follows these docker conventions:\r\n\r\n* `-ti` will run an interactive session that can be terminated with CTRL+C.\r\n* `--rm` will run a temporary session that will make sure to remove the container on exit.\r\n* `-e DISPLAY` sets the host display to the local machines display.\r\n* `-v /tmp/.X11-unix:/tmp/.X11-unix:ro` bind mounts the X11 socks on your local machine to the containers and makes it read only.\r\n* `-v ~/docker-data/wine:/home/docker/wine/` shared volume (folder) for your Window's programs data.\r\n* `-v /etc/localtime:/etc/localtime:ro \\` sets the containers clock to match the hosts clock.\r\n* `-u docker` sets the user to docker.\r\n* `yantis/wine /bin/bash -c \"sudo initialize-graphics; vglrun /home/docker/templates/skype.template;\"`\r\nInitialize the correct video drivers and launch the built in Skype run or install script.\r\nYou could just as easily do any other program though.\r\n\r\n\r\n## Usage (Remote)\r\n\r\n### Server\r\n\r\nThe recommended way to run this container looks like this. This example launches the container in the background.\r\nWarning: Do not run this on your primary computer as it will take over your video cards and you will have to shutdown the container\r\nto get them back.\r\n\r\n```bash\r\ndocker run \\\r\n    --privileged \\\r\n    -ti \\\r\n    --rm \\\r\n    -v $HOME/.ssh/authorized_keys:/authorized_keys:ro \\\r\n    -p 49158:22 \\\r\n    -v ~/docker-data/wine:/home/docker/wine/ \\\r\n    yantis/wine\r\n```\r\n\r\nThis follows these docker conventions:\r\n\r\n* `--privileged` run in privileged mode \r\n    If you do not want to run in privileged mode you can mess around with these:\r\n\r\n    AWS\r\n     * --device=/dev/nvidia0:/dev/nvidia0 \\\r\n     * --device=/dev/nvidiactl:/dev/nvidiactl \\\r\n     * --device=/dev/nvidia-uvm:/dev/nvidia-uvm \\\r\n\r\n    OR (Local)\r\n     * --device=/dev/dri/card0:/dev/dri/card0 \\\r\n\r\n* `-d` run in daemon mode\r\n* `-h docker` sets the hostname to docker. (not really required but it is nice to see where you are.)\r\n* `-v $HOME/.ssh/authorized_keys:/authorized_keys:ro` Optionally share your public keys with the host.\r\n    This is particularly useful when you are running this on another server that already has SSH. Like an \r\n    Amazon EC2 instance. WARNING: If you don't use this then it will just default to the user pass of docker/docker\r\n    (If you do specify authorized keys it will disable all password logins to keep it secure).\r\n* `-v /etc/localtime:/etc/localtime:ro` sets the containers clock to match the hosts clock.\r\n* `-p 49158:22` port that you will be connecting to.\r\n* `yantis/wine` the default mode is SSH server with the X-Server so no need to run any commands.\r\n\r\n\r\n### Client\r\n\r\nYou will probably want to have VirtualGL installed on your client. Though this isn't mandatory for all apps.\r\nie: For 2D apps you will not need this but for apps like Skype and most games you will.\r\n\r\nIf you are just using 2D apps you can simply SSH in.\r\n\r\n```bash\r\nssh -Y docker@hostname -p 49158 -t wine explorer.exe\r\n```\r\n\r\nIf you are using 3D apps though you need to use VirtualGL.\r\n\r\nOn Arch Linux it is:\r\n\r\n```bash\r\npacman -S virtualgl\r\n```\r\n\r\nIt is basically two programs you need both of which I have included in the [tools](https://github.com/yantis/docker-virtualgl/tree/master/tools)\r\ndirectory on my [docker-virtualgl](https://github.com/yantis/docker-virtualgl) repo\r\n\r\n* SSH Authentication but data stream is unencrypted (recommended)\r\n\r\n```bash\r\nvglconnect -Y docker@hostname -p 49158 -t vglrun wine explorer.exe\r\n```\r\n\r\n* SSH Authentication AND data stream is unencrypted\r\n\r\n```bash\r\nvglconnect -Y -s docker@hostname -p 49158 -t vglrun wine explorer.exe\r\n```\r\n\r\nIf you are running this remotely (ie: with an Amazon AWS server) You will want to open up port on your firewall\r\nor router to get the best speed out of this.  Otherwise it will use SSH to encrypt the display which will slow it down a good amount.\r\n(I have had varying degrees of success not opening the port when using the SSH method (Sometimes I have to open up the port period to get it to work.)\r\n\r\nCheck your ports as it doesn't always use 4242 sometimes it uses something else between 4200 and 4300.\r\nIf your screen is black or it isn't drawing then that is a good indication that the port is blocked.\r\n\r\n![](http://yantis-scripts.s3.amazonaws.com/virtualgl_port_forwarding.png)\r\n\r\nvglrun has a lot of tunable parameters. Make sure to check out the manual [here](http://www.virtualgl.org/vgldoc/2_1/)\r\n\r\n\r\n## Examples\r\n\r\nThis is the latest version of Skype on Windows (The Windows version has a lot of features that the Linux ones doesn't have\r\nlike the ability to ability to set notifications based on keywords or ignore them completely for some groups).\r\n\r\nI have included sample scripts to run this locally, over SSH (ie: on another computer on your LAN) as well as a script\r\nto run it on an AWS micro instance if you are interested in protecting your privacy (it is very easy to query your IP\r\naddress via one of the many Skype IP resolver sites out there).\r\n\r\nSkype actually needs 3D graphics support to work so we have to setup properly for that.\r\n\r\n```\r\nxhost +si:localuser:$(whoami) >/dev/null\r\ndocker run \\\r\n    --privileged \\\r\n    --rm \\\r\n    -ti \\\r\n    -e DISPLAY \\\r\n    -v /tmp/.X11-unix:/tmp/.X11-unix:ro \\\r\n    -v ~/docker-data/wine:/home/docker/wine/ \\\r\n    -v /etc/localtime:/etc/localtime:ro \\\r\n    -u docker \\\r\n    yantis/wine /bin/bash -c \"sudo initialize-graphics >/dev/null 2>/dev/null; vglrun /home/docker/templates/skype.template;\"\r\n```\r\n\r\n![](http://yantis-scripts.s3.amazonaws.com/skype_on_wine.png)\r\n\r\n\r\nThis is the latest version of [SQlyog](https://www.webyog.com/product/sqlyog). SQLyog doesn't need any 3D graphics so we can\r\nskip initializing them. Also, it doesn't need privelged mode so no reason to give it that either.\r\n\r\n\r\n```\r\nxhost +si:localuser:$(whoami) >/dev/null\r\ndocker run \\\r\n    --rm \\\r\n    -ti \\\r\n    -e DISPLAY \\\r\n    -v /tmp/.X11-unix:/tmp/.X11-unix:ro \\\r\n    -v ~/docker-data/wine:/home/docker/wine/ \\\r\n    -u docker \\\r\n    yantis/wine sh /home/docker/templates/sqlyog.template\r\n```\r\n\r\n![](http://yantis-scripts.s3.amazonaws.com/sqlyog_screenshot.png)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}